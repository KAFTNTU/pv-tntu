
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAR: –ú–∞–≥—ñ—è –†—É–∫</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #container {
            position: relative;
            width: 640px; /* –ë–∞–∑–æ–≤–∏–π —Ä–æ–∑–º—ñ—Ä –≤—ñ–¥–µ–æ */
            height: 480px;
        }

        /* –í—ñ–¥–µ–æ –∑ –≤–µ–±–∫–∞–º–µ—Ä–∏ - –Ω–∞ –∑–∞–¥–Ω—å–æ–º—É –ø–ª–∞–Ω—ñ */
        #webcam-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleX(-1); /* –î–∑–µ—Ä–∫–∞–ª—å–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è */
            object-fit: cover;
            z-index: 1;
        }

        /* –ö–∞–Ω–≤–∞—Å –¥–ª—è 3D –≥—Ä–∞—Ñ—ñ–∫–∏ - –ø–æ–≤–µ—Ä—Ö –≤—ñ–¥–µ–æ */
        #threejs-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2; /* –í–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç */
            pointer-events: none; /* –©–æ–± –∫–ª—ñ–∫–∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –∫—Ä—ñ–∑—å –Ω—å–æ–≥–æ */
        }

        #status {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            color: #00ffcc;
            font-family: sans-serif;
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            display: none;
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
</head>
<body>

    <div id="container">
        <div id="status">–ü–Ü–î–ù–Ü–ú–ò –†–£–ö–ò! üôå</div>
        <video id="webcam-video" playsinline></video>
        <canvas id="threejs-canvas"></canvas>
    </div>

<script>
    const videoElement = document.getElementById('webcam-video');
    const threeCanvas = document.getElementById('threejs-canvas');
    const statusText = document.getElementById('status');
    let isModelVisible = false;
    let poseResults = null;

    // ==========================================
    // –ß–ê–°–¢–ò–ù–ê 1: –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø 3D –°–¶–ï–ù–ò (Three.js)
    // ==========================================
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ —Å—Ü–µ–Ω—É
    const scene = new THREE.Scene();
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–∞–º–µ—Ä—É –¥–ª—è 3D —Å–≤—ñ—Ç—É
    const camera = new THREE.PerspectiveCamera(75, 640 / 480, 0.1, 1000);
    camera.position.z = 5; // –í—ñ–¥—Å—É–≤–∞—î–º–æ –∫–∞–º–µ—Ä—É –Ω–∞–∑–∞–¥

    // –°—Ç–≤–æ—Ä—é—î–º–æ —Ä–µ–Ω–¥–µ—Ä–µ—Ä (–º–∞–ª—é–≤–∞–ª—å–Ω–∏–∫)
    const renderer = new THREE.WebGLRenderer({ 
        canvas: threeCanvas, 
        alpha: true, // –í–ê–ñ–õ–ò–í–û: –ü—Ä–æ–∑–æ—Ä–∏–π —Ñ–æ–Ω, —â–æ–± –±–∞—á–∏—Ç–∏ –≤—ñ–¥–µ–æ –ø—ñ–¥ –Ω–∏–º
        antialias: true 
    });
    renderer.setSize(640, 480);
    renderer.setPixelRatio(window.devicePixelRatio);

    // --- –°–¢–í–û–†–Æ–Ñ–ú–û 3D –û–ë'–Ñ–ö–¢ (–ó–∞–º—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É, —Å—Ç–≤–æ—Ä–∏–º–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏–π –∫—É–±) ---
    
    // –ì–µ–æ–º–µ—Ç—Ä—ñ—è –∫—É–±–∞
    const geometry = new THREE.BoxGeometry(2, 2, 2);
    
    // –ú–∞—Ç–µ—Ä—ñ–∞–ª (–≤–∏–≥–ª—è–¥) - –∑—Ä–æ–±–∏–º–æ –π–æ–≥–æ –Ω–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä–∏–º —ñ –∫–∞—Ä–∫–∞—Å–Ω–∏–º –¥–ª—è —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ
    const material = new THREE.MeshBasicMaterial({ 
        color: 0x00ffcc,
        wireframe: true, // –ú–∞–ª—é–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Ä–µ–±—Ä–∞
        transparent: true,
        opacity: 0.8
    });

    // –û–±'—î–¥–Ω—É—î–º–æ –≥–µ–æ–º–µ—Ç—Ä—ñ—é —ñ –º–∞—Ç–µ—Ä—ñ–∞–ª —É –ú–µ—à (Mesh)
    const cube = new THREE.Mesh(geometry, material);
    
    // –°–ø–æ—á–∞—Ç–∫—É —Ö–æ–≤–∞—î–º–æ –π–æ–≥–æ
    cube.visible = false;
    scene.add(cube);

    // –î–æ–¥–∞–º–æ —Ç—Ä–æ—Ö–∏ —Å–≤—ñ—Ç–ª–∞ (—Ö–æ—á–∞ –¥–ª—è wireframe –º–∞—Ç–µ—Ä—ñ–∞–ª—É –≤–æ–Ω–æ –Ω–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–µ)
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(0, 1, 1).normalize();
    scene.add(light);


    // –§—É–Ω–∫—Ü—ñ—è –∞–Ω—ñ–º–∞—Ü—ñ—ó 3D —Å—Ü–µ–Ω–∏ (–≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø–æ—Å—Ç—ñ–π–Ω–æ)
    function animateThreeJS() {
        requestAnimationFrame(animateThreeJS);

        if (isModelVisible) {
            // –Ø–∫—â–æ –º–æ–¥–µ–ª—å –≤–∏–¥–∏–º–∞, –∫—Ä—É—Ç–∏–º–æ —ó—ó
            cube.rotation.x += 0.01;
            cube.rotation.y += 0.01;
            statusText.style.display = 'block';
        } else {
             statusText.style.display = 'none';
        }
        
        renderer.render(scene, camera);
    }
    animateThreeJS(); // –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ü–∏–∫–ª –∞–Ω—ñ–º–∞—Ü—ñ—ó


    // ==========================================
    // –ß–ê–°–¢–ò–ù–ê 2: –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –®–Ü (MediaPipe Pose)
    // ==========================================

    // –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —â–æ—Ä–∞–∑—É, –∫–æ–ª–∏ MediaPipe –æ–±—Ä–æ–±–∏–≤ –∫–∞–¥—Ä
    function onPoseResults(results) {
        poseResults = results;

        if (results.poseLandmarks) {
             // –û—Ç—Ä–∏–º—É—î–º–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤–∞–∂–ª–∏–≤–∏—Ö —Ç–æ—á–æ–∫ (–≤—ñ–¥ 0.0 –¥–æ 1.0, –¥–µ 0 - –≤–µ—Ä—Ö)
            const nose = results.poseLandmarks[0]; 
            const leftWrist = results.poseLandmarks[15]; // –õ—ñ–≤–µ –∑–∞–ø'—è—Å—Ç—è
            const rightWrist = results.poseLandmarks[16]; // –ü—Ä–∞–≤–µ –∑–∞–ø'—è—Å—Ç—è

            // –õ–û–ì–Ü–ö–ê: –Ø–∫—â–æ –û–ß–Ü (–Ω–æ—Å) —î –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
            // –Ü –û–ë–ò–î–í–ê –∑–∞–ø'—è—Å—Ç—è –≤–∏—â–µ –Ω–æ—Å–∞ (y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –º–µ–Ω—à–∞)
            if (nose.visibility > 0.8 && leftWrist.y < nose.y && rightWrist.y < nose.y) {
                isModelVisible = true;
                cube.visible = true;
            } else {
                isModelVisible = false;
                cube.visible = false;
            }
        }
    }

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è MediaPipe
    const pose = new Pose({locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
    }});

    pose.setOptions({
        modelComplexity: 1,
        smoothLandmarks: true,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
    });

    pose.onResults(onPoseResults);

    // –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä–∏
    const cameraFeed = new Camera(videoElement, {
        onFrame: async () => {
            await pose.send({image: videoElement});
        },
        width: 640,
        height: 480
    });
    cameraFeed.start();

    // –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –ø—ñ–¥ —Ä–æ–∑–º—ñ—Ä –≤—ñ–∫–Ω–∞
    window.addEventListener('resize', () => {
        // –¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –¥–ª—è –∑–º—ñ–Ω–∏ —Ä–æ–∑–º—ñ—Ä—ñ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –≤—ñ–∫–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–∞
    });

</script>
</body>
</html>
